# ── Dockerfile ─────────────────────────────────────────────
FROM python:3.12-slim

# Build tool-chain and Postgres headers for psycopg2 / NumPy wheels
RUN apt-get update && apt-get install -y \
      build-essential gcc g++ \
      libpq-dev postgresql-client \
      libatlas-base-dev            \
      && apt-get clean && rm -rf /var/lib/apt/lists/*

ENV PYTHONUNBUFFERED=1
WORKDIR /app

# First install up-to-date build helpers
COPY requirements.txt .
RUN pip install --upgrade pip setuptools wheel
RUN pip install -r requirements.txt

# Copy project code
COPY . .

# Cloud Run listens on $PORT (defaults to 8080)
CMD ["gunicorn", "--bind", "0.0.0.0:${PORT:-8080}", "pathpilot.wsgi:application"]
